<!DOCTYPE html>
<html lang="ne">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#b91c1c">
<meta name="description" content="à¤¨à¤¯à¤¾ à¤ªà¤¾à¤¤à¥à¤°à¥‹ - Nepal's Beautiful Nepali Calendar with Holidays, Reminders & More">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="à¤¨à¤¯à¤¾ à¤ªà¤¾à¤¤à¥à¤°à¥‹">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>à¤¨à¤¯à¤¾ à¤ªà¤¾à¤¤à¥à¤°à¥‹</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300;400;600;700;800&family=Tiro+Devanagari+Hindi:ital@0;1&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROOT VARIABLES & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --crimson: #b91c1c;
  --crimson-light: #ef4444;
  --crimson-dark: #7f1d1d;
  --gold: #d97706;
  --gold-light: #fbbf24;
  --gold-pale: #fef3c7;
  --bg: #0c0a0a;
  --bg2: #1a1010;
  --bg3: #231515;
  --card: #1c1212;
  --card2: #241a1a;
  --border: rgba(255,255,255,0.07);
  --border2: rgba(185,28,28,0.3);
  --text: #faf5f5;
  --text2: #c4a8a8;
  --text3: #7a5656;
  --sat: #60a5fa;
  --sun: #f87171;
  --green: #10b981;
  --purple: #8b5cf6;
  --shadow: 0 8px 40px rgba(0,0,0,0.6);
  --r: 14px;
  --r2: 20px;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

html { scroll-behavior: smooth; }

body {
  font-family: 'Mukta', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  padding-bottom: 80px;
}

/* â”€â”€â”€ Grain texture overlay â”€â”€â”€ */
body::before {
  content:'';
  position:fixed; inset:0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events:none; z-index:0; opacity:0.4;
}

/* â”€â”€â”€ Radial glow backgrounds â”€â”€â”€ */
.glow-bg {
  position:fixed; top:-200px; left:-100px;
  width:600px; height:600px;
  background: radial-gradient(ellipse, rgba(185,28,28,0.15) 0%, transparent 70%);
  pointer-events:none; z-index:0;
  animation: drift 8s ease-in-out infinite alternate;
}
.glow-bg2 {
  position:fixed; bottom:-200px; right:-100px;
  width:500px; height:500px;
  background: radial-gradient(ellipse, rgba(217,119,6,0.08) 0%, transparent 70%);
  pointer-events:none; z-index:0;
}

@keyframes drift { to { transform: translate(30px, 20px); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   APP SHELL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app {
  position:relative; z-index:1;
  max-width: 480px;
  margin: 0 auto;
  padding: 0 12px;
}

/* â”€â”€â”€ TOP BAR â”€â”€â”€ */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 4px 10px;
}
.brand {
  display: flex;
  flex-direction: column;
  line-height: 1;
}
.brand-ne {
  font-family: 'Tiro Devanagari Hindi', serif;
  font-size: 26px;
  font-weight: 700;
  color: var(--gold-light);
  text-shadow: 0 0 25px rgba(251,191,36,0.4);
}
.brand-en {
  font-size: 9px;
  font-weight: 600;
  color: var(--text3);
  letter-spacing: 3px;
  text-transform: uppercase;
}
.topbar-actions {
  display: flex;
  gap: 8px;
}
.icon-btn {
  background: var(--card2);
  border: 1px solid var(--border);
  color: var(--text2);
  width: 38px; height: 38px;
  border-radius: 12px;
  font-size: 18px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
}
.icon-btn:hover, .icon-btn.active { background: var(--crimson); border-color: var(--crimson); color: white; }
.notif-dot {
  position: absolute;
  top: 6px; right: 6px;
  width: 8px; height: 8px;
  background: var(--gold-light);
  border-radius: 50%;
  border: 2px solid var(--bg);
  animation: pulse 2s infinite;
}
@keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.3);} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TODAY BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.today-banner {
  background: linear-gradient(135deg, #1f1010 0%, #2a1515 50%, #1a1220 100%);
  border: 1px solid var(--border2);
  border-radius: var(--r2);
  padding: 16px 18px;
  margin-bottom: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: var(--shadow), inset 0 1px 0 rgba(255,255,255,0.05);
  animation: fadeSlideDown 0.5s ease both;
}
@keyframes fadeSlideDown { from{opacity:0;transform:translateY(-10px);} to{opacity:1;transform:none;} }

.today-left {}
.today-bs-num {
  font-family: 'Tiro Devanagari Hindi', serif;
  font-size: 56px;
  font-weight: 700;
  color: var(--crimson-light);
  line-height: 1;
  text-shadow: 0 0 30px rgba(239,68,68,0.4);
}
.today-bs-sub {
  font-size: 13px;
  color: var(--text3);
  font-weight: 600;
  letter-spacing: 0.5px;
  margin-top: 2px;
}
.today-right {
  text-align: right;
}
.today-weekday {
  font-size: 22px;
  font-weight: 800;
  color: var(--text);
}
.today-en-date {
  font-size: 12px;
  color: var(--text2);
  margin-top: 2px;
}
.today-tithi {
  font-family: 'Tiro Devanagari Hindi', serif;
  font-size: 13px;
  color: var(--gold-light);
  margin-top: 4px;
}
.today-holiday-chip {
  display: inline-block;
  background: rgba(185,28,28,0.3);
  border: 1px solid var(--crimson);
  color: var(--sun);
  font-size: 10px;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 20px;
  margin-top: 4px;
  letter-spacing: 0.5px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QUICK STATS ROW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.quick-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
  margin-bottom: 14px;
}
.stat-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 10px 12px;
  text-align: center;
  transition: all 0.2s;
  cursor: pointer;
}
.stat-card:hover { border-color: var(--border2); transform: translateY(-2px); }
.stat-icon { font-size: 20px; margin-bottom: 2px; }
.stat-val { font-size: 18px; font-weight: 800; color: var(--text); }
.stat-lbl { font-size: 10px; color: var(--text3); font-weight: 600; letter-spacing: 0.5px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOTTOM NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: rgba(12,10,10,0.95);
  backdrop-filter: blur(20px);
  border-top: 1px solid var(--border);
  display: flex;
  z-index: 100;
  padding-bottom: env(safe-area-inset-bottom, 0px);
}
.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px 4px 8px;
  cursor: pointer;
  transition: all 0.2s;
  gap: 3px;
}
.nav-icon { font-size: 22px; transition: transform 0.2s; }
.nav-label { font-size: 9px; font-weight: 700; letter-spacing: 0.5px; color: var(--text3); text-transform: uppercase; transition: color 0.2s; }
.nav-item.active .nav-icon { transform: scale(1.2); }
.nav-item.active .nav-label { color: var(--crimson-light); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTIONS (hidden/shown)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section { display: none; animation: fadeIn 0.3s ease; }
.section.active { display: block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(6px);} to{opacity:1;transform:none;} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDAR SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cal-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}
.cal-nav-btn {
  background: var(--card2);
  border: 1px solid var(--border);
  color: var(--text);
  width: 36px; height: 36px;
  border-radius: 10px;
  font-size: 18px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex; align-items: center; justify-content: center;
}
.cal-nav-btn:hover { background: var(--crimson); border-color: var(--crimson); }
.month-title-wrap { text-align: center; cursor: pointer; }
.month-ne {
  font-family: 'Tiro Devanagari Hindi', serif;
  font-size: 22px;
  font-weight: 700;
  color: var(--text);
}
.month-en { font-size: 11px; color: var(--text3); letter-spacing: 1px; }

.cal-grid-wrap {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  overflow: hidden;
  box-shadow: var(--shadow);
  margin-bottom: 14px;
}
.day-headers {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  background: var(--bg3);
  border-bottom: 1px solid var(--border);
}
.day-hdr {
  padding: 8px 0;
  text-align: center;
  font-size: 10px;
  font-weight: 800;
  letter-spacing: 0.5px;
  color: var(--text3);
}
.day-hdr.sat { color: var(--sat); }
.day-hdr.sun { color: var(--sun); }

.cal-days {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
}
.day-cell {
  min-height: 58px;
  padding: 5px 4px 4px;
  border-right: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
  cursor: pointer;
  transition: background 0.15s;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.day-cell:hover { background: rgba(185,28,28,0.1); }
.day-cell.other-month { opacity: 0.25; }
.day-cell.today {
  background: rgba(185,28,28,0.15);
}
.day-cell.today .bs-num {
  background: var(--crimson);
  color: white;
  border-radius: 50%;
  width: 26px; height: 26px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 0 12px rgba(185,28,28,0.5);
}
.day-cell.holiday { background: rgba(248,113,113,0.06); }
.day-cell.selected { background: rgba(217,119,6,0.15); border: 1px solid var(--gold); }

.bs-num {
  font-family: 'Tiro Devanagari Hindi', serif;
  font-size: 18px;
  font-weight: 700;
  color: var(--text);
  line-height: 1;
  margin-bottom: 2px;
}
.en-num {
  font-size: 9px;
  color: var(--text3);
  font-weight: 600;
}
.day-cell.sat .bs-num { color: var(--sat); }
.day-cell.sun .bs-num, .day-cell.holiday .bs-num { color: var(--sun); }
.day-cell.holiday .en-num { color: var(--crimson-light); }

.holiday-dot {
  width: 4px; height: 4px;
  border-radius: 50%;
  background: var(--crimson-light);
  margin-top: 2px;
}
.event-dot {
  width: 4px; height: 4px;
  border-radius: 50%;
  background: var(--gold);
  margin-top: 1px;
}
.holiday-name-tiny {
  font-size: 7px;
  color: var(--sun);
  text-align: center;
  line-height: 1.1;
  margin-top: 1px;
  font-weight: 700;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATE DETAIL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  display: none;
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(4px);
  z-index: 200;
  align-items: flex-end;
  justify-content: center;
}
.modal-overlay.open { display: flex; }
.modal-sheet {
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 24px 24px 0 0;
  width: 100%;
  max-width: 480px;
  padding: 0 0 40px;
  animation: slideUp 0.3s cubic-bezier(0.34,1.56,0.64,1);
  max-height: 85vh;
  overflow-y: auto;
}
@keyframes slideUp { from{transform:translateY(100%);} to{transform:none;} }
.sheet-handle {
  width: 40px; height: 4px;
  background: var(--text3);
  border-radius: 2px;
  margin: 12px auto 0;
}
.sheet-close {
  position: absolute;
  top: 16px; right: 16px;
  font-size: 22px;
  cursor: pointer;
  color: var(--text3);
  background: var(--card2);
  border: none;
  width: 32px; height: 32px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
}

.detail-head {
  padding: 16px 20px 14px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: flex-start;
  gap: 14px;
  position: relative;
}
.detail-bs-big {
  font-family: 'Tiro Devanagari Hindi', serif;
  font-size: 60px;
  font-weight: 700;
  color: var(--crimson-light);
  line-height: 1;
}
.detail-info { flex: 1; }
.detail-weekday { font-size: 20px; font-weight: 800; }
.detail-month-year { font-size: 13px; color: var(--text2); margin-top: 2px; }
.detail-en { font-size: 12px; color: var(--text3); margin-top: 4px; }

.detail-section { padding: 14px 20px; border-bottom: 1px solid var(--border); }
.detail-section:last-child { border-bottom: none; }
.detail-sec-title {
  font-size: 11px;
  font-weight: 800;
  color: var(--text3);
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 10px;
}
.holiday-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  background: rgba(185,28,28,0.1);
  border: 1px solid rgba(185,28,28,0.2);
  border-radius: 10px;
  margin-bottom: 6px;
}
.holiday-item-icon { font-size: 20px; }
.holiday-item-name { font-weight: 700; font-size: 14px; color: var(--sun); }
.holiday-item-type { font-size: 11px; color: var(--text3); }

.tithi-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}
.tithi-box {
  background: var(--card2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px;
}
.tithi-label { font-size: 10px; color: var(--text3); font-weight: 700; letter-spacing: 0.5px; margin-bottom: 3px; }
.tithi-val { font-family: 'Tiro Devanagari Hindi', serif; font-size: 15px; color: var(--gold-light); font-weight: 600; }

/* â”€â”€â”€ Add Event Button in Detail â”€â”€â”€ */
.add-event-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  padding: 12px 14px;
  background: var(--card2);
  border: 1px dashed var(--border2);
  border-radius: 10px;
  color: var(--text2);
  font-size: 14px;
  font-family: 'Mukta', sans-serif;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 8px;
}
.add-event-btn:hover { background: rgba(185,28,28,0.15); color: var(--text); border-color: var(--crimson); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOLIDAYS SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section-header {
  font-size: 20px;
  font-weight: 800;
  color: var(--text);
  margin-bottom: 14px;
  padding-top: 4px;
}
.section-header span { color: var(--crimson-light); }

.month-group { margin-bottom: 18px; }
.month-group-title {
  font-family: 'Tiro Devanagari Hindi', serif;
  font-size: 14px;
  color: var(--gold-light);
  font-weight: 700;
  margin-bottom: 8px;
  padding: 4px 0;
  border-bottom: 1px solid var(--border);
}

.holiday-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 6px;
  transition: all 0.2s;
  cursor: pointer;
}
.holiday-card:hover { border-color: var(--border2); transform: translateX(3px); }
.holiday-card.rajpatra { border-left: 3px solid var(--crimson-light); }
.holiday-card.festival { border-left: 3px solid var(--gold); }
.hc-date-box {
  text-align: center;
  min-width: 42px;
}
.hc-bs { font-family: 'Tiro Devanagari Hindi', serif; font-size: 24px; font-weight: 700; color: var(--crimson-light); line-height: 1; }
.hc-month { font-size: 9px; color: var(--text3); font-weight: 700; letter-spacing: 0.5px; }
.hc-info { flex: 1; }
.hc-name { font-size: 15px; font-weight: 700; color: var(--text); }
.hc-name-ne { font-family: 'Tiro Devanagari Hindi', serif; font-size: 13px; color: var(--text2); }
.hc-badge {
  font-size: 9px;
  font-weight: 800;
  padding: 2px 7px;
  border-radius: 20px;
  letter-spacing: 0.5px;
}
.badge-rajpatra { background: rgba(185,28,28,0.2); color: var(--sun); border: 1px solid var(--crimson); }
.badge-festival { background: rgba(217,119,6,0.15); color: var(--gold-light); border: 1px solid var(--gold); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REMINDERS SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.reminder-form {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  padding: 16px;
  margin-bottom: 16px;
}
.form-title { font-size: 15px; font-weight: 800; margin-bottom: 12px; }
.form-group { margin-bottom: 10px; }
.form-label { font-size: 11px; color: var(--text3); font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; margin-bottom: 4px; display: block; }
.form-input, .form-select {
  width: 100%;
  padding: 10px 12px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-size: 14px;
  font-family: 'Mukta', sans-serif;
  outline: none;
  transition: border-color 0.2s;
}
.form-input:focus, .form-select:focus { border-color: var(--crimson); }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.btn-primary {
  width: 100%;
  padding: 12px;
  background: var(--crimson);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 800;
  font-family: 'Mukta', sans-serif;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 4px;
}
.btn-primary:hover { background: var(--crimson-light); transform: translateY(-1px); box-shadow: 0 4px 20px rgba(185,28,28,0.4); }
.btn-primary:active { transform: translateY(0); }

.reminder-list { }
.reminder-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 8px;
  animation: fadeIn 0.3s;
}
.reminder-icon { font-size: 24px; }
.reminder-info { flex: 1; }
.reminder-title { font-size: 14px; font-weight: 700; }
.reminder-meta { font-size: 11px; color: var(--text3); margin-top: 2px; }
.reminder-del {
  background: none;
  border: none;
  color: var(--text3);
  font-size: 18px;
  cursor: pointer;
  padding: 4px;
  transition: color 0.2s;
}
.reminder-del:hover { color: var(--sun); }

/* â”€â”€â”€ Toggle â”€â”€â”€ */
.toggle-wrap {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 4px 0;
}
.toggle-label { font-size: 13px; color: var(--text2); }
.toggle {
  width: 44px; height: 24px;
  background: var(--text3);
  border-radius: 12px;
  position: relative;
  cursor: pointer;
  transition: background 0.2s;
}
.toggle.on { background: var(--crimson); }
.toggle::after {
  content:'';
  position:absolute;
  top:3px; left:3px;
  width:18px; height:18px;
  border-radius:50%;
  background:white;
  transition: transform 0.2s;
}
.toggle.on::after { transform: translateX(20px); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RAJ PATRA SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rajpatra-hero {
  background: linear-gradient(135deg, var(--crimson-dark) 0%, #1a0a0a 100%);
  border: 1px solid var(--border2);
  border-radius: var(--r2);
  padding: 20px;
  margin-bottom: 14px;
  text-align: center;
}
.rp-icon { font-size: 48px; margin-bottom: 8px; }
.rp-title { font-size: 20px; font-weight: 800; margin-bottom: 4px; }
.rp-sub { font-size: 12px; color: var(--text2); line-height: 1.5; margin-bottom: 14px; }
.btn-secondary {
  display: inline-block;
  padding: 10px 24px;
  background: transparent;
  color: var(--gold-light);
  border: 1px solid var(--gold);
  border-radius: 10px;
  font-size: 13px;
  font-weight: 700;
  font-family: 'Mukta', sans-serif;
  cursor: pointer;
  transition: all 0.2s;
  text-decoration: none;
  margin: 4px;
}
.btn-secondary:hover { background: rgba(217,119,6,0.15); }

.rp-update-list { }
.rp-item {
  display: flex;
  gap: 12px;
  padding: 12px 14px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 8px;
  align-items: flex-start;
}
.rp-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
  margin-top: 5px;
  flex-shrink: 0;
}
.rp-dot.new { background: var(--crimson-light); box-shadow: 0 0 8px var(--crimson-light); }
.rp-dot.old { background: var(--text3); }
.rp-item-info {}
.rp-item-title { font-size: 14px; font-weight: 700; margin-bottom: 2px; }
.rp-item-date { font-size: 11px; color: var(--text3); }
.rp-item-source { font-size: 11px; color: var(--sat); text-decoration: none; }
.rp-item-source:hover { text-decoration: underline; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MORE / SETTINGS SECTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-list { }
.settings-group { margin-bottom: 14px; }
.settings-group-title { font-size: 10px; color: var(--text3); font-weight: 800; letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 8px; padding-left: 4px; }
.settings-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 13px 14px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 6px;
  cursor: pointer;
  transition: all 0.2s;
}
.settings-item:hover { border-color: var(--border2); }
.settings-item-left { display: flex; align-items: center; gap: 12px; }
.settings-item-icon {
  width: 36px; height: 36px;
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 18px;
}
.settings-item-text {}
.settings-item-title { font-size: 14px; font-weight: 700; }
.settings-item-sub { font-size: 11px; color: var(--text3); margin-top: 1px; }
.settings-item-right { color: var(--text3); font-size: 18px; }

.about-box {
  text-align: center;
  padding: 20px;
  color: var(--text3);
  font-size: 12px;
  line-height: 1.8;
}
.about-logo {
  font-family: 'Tiro Devanagari Hindi', serif;
  font-size: 32px;
  color: var(--gold-light);
  text-shadow: 0 0 20px rgba(251,191,36,0.3);
  display: block;
  margin-bottom: 4px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATION PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notif-panel {
  display: none;
  position: fixed;
  top: 0; right: 0; bottom: 0;
  width: min(340px, 100vw);
  background: var(--bg2);
  border-left: 1px solid var(--border);
  z-index: 300;
  overflow-y: auto;
  animation: slideLeft 0.3s ease;
  padding-bottom: 40px;
}
.notif-panel.open { display: block; }
@keyframes slideLeft { from{transform:translateX(100%);} to{transform:none;} }
.notif-head {
  padding: 20px 16px 12px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: sticky;
  top: 0;
  background: var(--bg2);
}
.notif-head-title { font-size: 18px; font-weight: 800; }
.notif-close { background:none; border:none; color:var(--text3); font-size:22px; cursor:pointer; }
.notif-item {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  gap: 10px;
  align-items: flex-start;
  transition: background 0.15s;
}
.notif-item:hover { background: var(--card); }
.notif-item.unread { background: rgba(185,28,28,0.05); }
.notif-item-icon { font-size: 22px; }
.notif-item-content {}
.notif-item-title { font-size: 13px; font-weight: 700; margin-bottom: 2px; }
.notif-item-body { font-size: 12px; color: var(--text2); line-height: 1.4; }
.notif-item-time { font-size: 10px; color: var(--text3); margin-top: 3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast {
  position: fixed;
  top: 20px; left: 50%; transform: translateX(-50%) translateY(-80px);
  background: var(--bg3);
  border: 1px solid var(--border2);
  color: var(--text);
  padding: 10px 20px;
  border-radius: 30px;
  font-size: 13px;
  font-weight: 700;
  z-index: 999;
  transition: transform 0.3s cubic-bezier(0.34,1.56,0.64,1);
  white-space: nowrap;
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANCHANG / WEATHER WIDGET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.panchang-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--r2);
  padding: 14px 16px;
  margin-bottom: 14px;
}
.panchang-title { font-size: 12px; font-weight: 800; color: var(--text3); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 12px; }
.panchang-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 8px;
}
.panch-item {
  background: var(--bg3);
  border-radius: 10px;
  padding: 8px 10px;
}
.panch-lbl { font-size: 9px; color: var(--text3); font-weight: 700; letter-spacing: 0.5px; text-transform: uppercase; margin-bottom: 2px; }
.panch-val { font-family: 'Tiro Devanagari Hindi', serif; font-size: 14px; color: var(--gold-light); font-weight: 600; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPCOMING EVENTS STRIP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.upcoming-strip {
  margin-bottom: 14px;
}
.upcoming-title { font-size: 12px; font-weight: 800; color: var(--text3); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; }
.upcoming-scroll {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding-bottom: 4px;
  scrollbar-width: none;
}
.upcoming-scroll::-webkit-scrollbar { display: none; }
.upcoming-chip {
  flex-shrink: 0;
  background: var(--card2);
  border: 1px solid var(--border2);
  border-radius: 12px;
  padding: 8px 12px;
  cursor: pointer;
  transition: all 0.2s;
  min-width: 110px;
}
.upcoming-chip:hover { background: rgba(185,28,28,0.15); }
.uc-days { font-size: 10px; color: var(--crimson-light); font-weight: 800; margin-bottom: 2px; }
.uc-name { font-size: 12px; font-weight: 700; line-height: 1.2; }
.uc-date { font-size: 10px; color: var(--text3); margin-top: 2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INSTALL PROMPT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.install-banner {
  background: linear-gradient(135deg, #1a1530 0%, #0f1a20 100%);
  border: 1px solid rgba(96,165,250,0.3);
  border-radius: var(--r2);
  padding: 14px 16px;
  margin-bottom: 14px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.install-icon { font-size: 32px; }
.install-info { flex: 1; }
.install-title { font-size: 14px; font-weight: 800; color: var(--sat); }
.install-sub { font-size: 11px; color: var(--text2); margin-top: 2px; line-height: 1.4; }
.install-btn {
  background: var(--sat);
  color: #0c0a0a;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 800;
  font-family: 'Mukta', sans-serif;
  cursor: pointer;
  white-space: nowrap;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLLBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE POLISH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 380px) {
  .today-bs-num { font-size: 44px; }
  .bs-num { font-size: 16px; }
  .day-cell { min-height: 50px; }
}
</style>
</head>
<body>

<div class="glow-bg"></div>
<div class="glow-bg2"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• NOTIFICATION PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="notif-panel" id="notifPanel">
  <div class="notif-head">
    <span class="notif-head-title">ğŸ”” Notifications</span>
    <button class="notif-close" onclick="closeNotifPanel()">âœ•</button>
  </div>
  <div id="notifList"></div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DATE DETAIL MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal-overlay" id="detailModal" onclick="closeModal(event)">
  <div class="modal-sheet" id="modalSheet">
    <div class="sheet-handle"></div>
    <button class="sheet-close" onclick="closeDetailModal()">âœ•</button>
    <div id="modalContent"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MAIN APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="app">

  <!-- TOP BAR -->
  <div class="topbar">
    <div class="brand">
      <span class="brand-ne">à¤¨à¤¯à¤¾ à¤ªà¤¾à¤¤à¥à¤°à¥‹</span>
      <span class="brand-en">Naya Patro</span>
    </div>
    <div class="topbar-actions">
      <div class="icon-btn" onclick="toggleNotifPanel()" id="bellBtn" title="Notifications">
        ğŸ””
        <span class="notif-dot" id="notifDot"></span>
      </div>
      <div class="icon-btn" onclick="goToToday()" title="Go to Today">ğŸ“…</div>
    </div>
  </div>

  <!-- â•â•â• SECTION: HOME / CALENDAR â•â•â• -->
  <div class="section active" id="sec-home">

    <!-- TODAY BANNER -->
    <div class="today-banner" id="todayBanner">
      <div class="today-left">
        <div class="today-bs-num" id="todayBsNum">â€”</div>
        <div class="today-bs-sub" id="todayBsSub">à¤¬à¥ˆà¤¶à¤¾à¤–, à¥¨à¥¦à¥®à¥¨</div>
      </div>
      <div class="today-right">
        <div class="today-weekday" id="todayWeekday">â€”</div>
        <div class="today-en-date" id="todayEnDate">â€”</div>
        <div class="today-tithi" id="todayTithi">â€”</div>
        <div id="todayHolidayChip"></div>
      </div>
    </div>

    <!-- UPCOMING HOLIDAYS STRIP -->
    <div class="upcoming-strip">
      <div class="upcoming-title">ğŸ“Œ UPCOMING HOLIDAYS</div>
      <div class="upcoming-scroll" id="upcomingStrip"></div>
    </div>

    <!-- CALENDAR NAV -->
    <div class="cal-nav">
      <button class="cal-nav-btn" onclick="prevMonth()">â€¹</button>
      <div class="month-title-wrap" onclick="showSection('sec-home')">
        <div class="month-ne" id="calMonthNe">â€”</div>
        <div class="month-en" id="calMonthEn">â€”</div>
      </div>
      <button class="cal-nav-btn" onclick="nextMonth()">â€º</button>
    </div>

    <!-- CALENDAR GRID -->
    <div class="cal-grid-wrap">
      <div class="day-headers">
        <div class="day-hdr sun">à¤†à¤‡à¤¤</div>
        <div class="day-hdr">à¤¸à¥‹à¤®</div>
        <div class="day-hdr">à¤®à¤‚à¤—à¤²</div>
        <div class="day-hdr">à¤¬à¥à¤§</div>
        <div class="day-hdr">à¤¬à¤¿à¤¹à¥€</div>
        <div class="day-hdr">à¤¶à¥à¤•à¥à¤°</div>
        <div class="day-hdr sat">à¤¶à¤¨à¤¿</div>
      </div>
      <div class="cal-days" id="calDays"></div>
    </div>

    <!-- PANCHANG -->
    <div class="panchang-card">
      <div class="panchang-title">ğŸ“¿ à¤ªà¤à¥à¤šà¤¾à¤™à¥à¤— â€” Panchang Today</div>
      <div class="panchang-grid" id="panchaGrid"></div>
    </div>

    <!-- QUICK STATS -->
    <div class="quick-stats">
      <div class="stat-card" onclick="showSection('sec-holidays')">
        <div class="stat-icon">ğŸ‰</div>
        <div class="stat-val" id="statHolidays">â€”</div>
        <div class="stat-lbl">Holidays / Year</div>
      </div>
      <div class="stat-card" onclick="showSection('sec-reminders')">
        <div class="stat-icon">â°</div>
        <div class="stat-val" id="statReminders">0</div>
        <div class="stat-lbl">My Reminders</div>
      </div>
      <div class="stat-card" onclick="showSection('sec-rajpatra')">
        <div class="stat-icon">ğŸ“‹</div>
        <div class="stat-val">à¤°à¤œ</div>
        <div class="stat-lbl">Raj Patra</div>
      </div>
    </div>

    <!-- INSTALL BANNER -->
    <div class="install-banner" id="installBanner" style="display:none;">
      <div class="install-icon">ğŸ“²</div>
      <div class="install-info">
        <div class="install-title">Install Naya Patro</div>
        <div class="install-sub">Add to home screen for offline use & notifications</div>
      </div>
      <button class="install-btn" onclick="installPWA()">Install</button>
    </div>

  </div>

  <!-- â•â•â• SECTION: HOLIDAYS â•â•â• -->
  <div class="section" id="sec-holidays">
    <div class="section-header">ğŸ‰ <span>Holidays</span> 2082 BS</div>
    <div id="holidayList"></div>
  </div>

  <!-- â•â•â• SECTION: REMINDERS â•â•â• -->
  <div class="section" id="sec-reminders">
    <div class="section-header">â° My <span>Reminders</span></div>
    <div class="reminder-form">
      <div class="form-title">â• Add New Reminder</div>
      <div class="form-group">
        <label class="form-label">Title</label>
        <input class="form-input" id="remTitle" placeholder="e.g. Doctor Appointment, Meeting..." type="text">
      </div>
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Date</label>
          <input class="form-input" id="remDate" type="date">
        </div>
        <div class="form-group">
          <label class="form-label">Time</label>
          <input class="form-input" id="remTime" type="time">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Type</label>
        <select class="form-select" id="remType">
          <option value="personal">ğŸ‘¤ Personal</option>
          <option value="work">ğŸ’¼ Work</option>
          <option value="health">ğŸ¥ Health</option>
          <option value="festival">ğŸŠ Festival</option>
          <option value="birthday">ğŸ‚ Birthday</option>
          <option value="anniversary">ğŸ’‘ Anniversary</option>
          <option value="other">ğŸ“Œ Other</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Note (optional)</label>
        <input class="form-input" id="remNote" placeholder="Add a note...">
      </div>
      <div class="toggle-wrap" style="margin-bottom:10px;">
        <span class="toggle-label">ğŸ”” Notify before 1 day</span>
        <div class="toggle on" id="remNotifToggle" onclick="this.classList.toggle('on')"></div>
      </div>
      <button class="btn-primary" onclick="addReminder()">Save Reminder</button>
    </div>
    <div id="reminderList"></div>
  </div>

  <!-- â•â•â• SECTION: RAJ PATRA â•â•â• -->
  <div class="section" id="sec-rajpatra">
    <div class="section-header">ğŸ“‹ <span>Raj Patra</span></div>
    <div class="rajpatra-hero">
      <div class="rp-icon">ğŸ›ï¸</div>
      <div class="rp-title">à¤°à¤¾à¤œà¤ªà¤¤à¥à¤° â€” Official Gazette</div>
      <div class="rp-sub">All holidays shown in Naya Patro are based on Nepal Government's official Raj Patra. When new holidays are declared, update the app to reflect changes.</div>
      <a class="btn-secondary" href="https://rajpatra.dop.gov.np" target="_blank">ğŸŒ Visit Raj Patra</a>
      <button class="btn-secondary" onclick="manualRefreshHolidays()">ğŸ”„ Refresh Holidays</button>
    </div>
    <div class="upcoming-title" style="margin-bottom:8px;">ğŸ“° RECENT RAJ PATRA NOTICES</div>
    <div id="rajpatraList"></div>
    <div style="margin-top:14px;">
      <div class="upcoming-title" style="margin-bottom:8px;">â„¹ï¸ HOW IT WORKS</div>
      <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px;font-size:12px;color:var(--text2);line-height:1.8;">
        <p>ğŸ“Œ <strong style="color:var(--text)">Pre-loaded holidays</strong> â€” All 2082 BS official holidays are pre-loaded from the Nepal government Raj Patra.</p><br>
        <p>ğŸ”„ <strong style="color:var(--text)">Manual sync</strong> â€” When Nepal government announces new special holidays (e.g. during elections or events), visit Raj Patra website, check the notice, then tap "Refresh Holidays" to add custom dates.</p><br>
        <p>ğŸ”” <strong style="color:var(--text)">Notifications</strong> â€” Naya Patro will remind you about holidays 1 day before automatically.</p>
      </div>
    </div>
  </div>

  <!-- â•â•â• SECTION: MORE / SETTINGS â•â•â• -->
  <div class="section" id="sec-more">
    <div class="section-header">âš™ï¸ <span>More</span></div>

    <!-- NOTIFICATION SETTINGS -->
    <div class="settings-group">
      <div class="settings-group-title">ğŸ”” Notifications</div>
      <div class="settings-item" onclick="requestNotifPermission()">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(185,28,28,0.15);">ğŸ””</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Enable Notifications</div>
            <div class="settings-item-sub" id="notifStatus">Tap to enable push notifications</div>
          </div>
        </div>
        <div class="settings-item-right">â€º</div>
      </div>
      <div class="settings-item">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(251,191,36,0.15);">ğŸŒ…</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Morning Panchang Alert</div>
            <div class="settings-item-sub">Daily tithi & event at 7 AM</div>
          </div>
        </div>
        <div class="toggle on" id="morningToggle" style="flex-shrink:0;" onclick="this.classList.toggle('on'); saveSetting('morningAlert', this.classList.contains('on'))"></div>
      </div>
      <div class="settings-item">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(96,165,250,0.15);">ğŸ‰</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Holiday Reminder</div>
            <div class="settings-item-sub">1 day before every holiday</div>
          </div>
        </div>
        <div class="toggle on" id="holidayToggle" style="flex-shrink:0;" onclick="this.classList.toggle('on'); saveSetting('holidayAlert', this.classList.contains('on'))"></div>
      </div>
    </div>

    <!-- DISPLAY -->
    <div class="settings-group">
      <div class="settings-group-title">ğŸ¨ Display</div>
      <div class="settings-item" onclick="toggleTheme()">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(139,92,246,0.15);">ğŸŒ™</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Dark Mode</div>
            <div class="settings-item-sub">Currently: Dark (Recommended)</div>
          </div>
        </div>
        <div class="settings-item-right">âœ“</div>
      </div>
      <div class="settings-item" onclick="showSection('sec-home')">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(16,185,129,0.15);">ğŸ“…</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Show AD Date</div>
            <div class="settings-item-sub">English date on calendar cells</div>
          </div>
        </div>
        <div class="toggle on" id="adToggle" style="flex-shrink:0;" onclick="this.classList.toggle('on');"></div>
      </div>
    </div>

    <!-- SHARE / INSTALL -->
    <div class="settings-group">
      <div class="settings-group-title">ğŸ“± App</div>
      <div class="settings-item" onclick="installPWA()">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(96,165,250,0.15);">ğŸ“²</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Install App</div>
            <div class="settings-item-sub">Add to home screen for offline use</div>
          </div>
        </div>
        <div class="settings-item-right">â€º</div>
      </div>
      <div class="settings-item" onclick="shareApp()">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(16,185,129,0.15);">ğŸ”—</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Share Naya Patro</div>
            <div class="settings-item-sub">Tell friends about this app</div>
          </div>
        </div>
        <div class="settings-item-right">â€º</div>
      </div>
      <div class="settings-item" onclick="exportReminders()">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(217,119,6,0.15);">ğŸ“¤</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Export Reminders</div>
            <div class="settings-item-sub">Download your reminders as text</div>
          </div>
        </div>
        <div class="settings-item-right">â€º</div>
      </div>
      <div class="settings-item" onclick="clearAllData()">
        <div class="settings-item-left">
          <div class="settings-item-icon" style="background:rgba(239,68,68,0.15);">ğŸ—‘ï¸</div>
          <div class="settings-item-text">
            <div class="settings-item-title">Clear All Data</div>
            <div class="settings-item-sub">Delete all reminders & settings</div>
          </div>
        </div>
        <div class="settings-item-right">â€º</div>
      </div>
    </div>

    <!-- ABOUT -->
    <div class="about-box">
      <span class="about-logo">à¤¨à¤¯à¤¾ à¤ªà¤¾à¤¤à¥à¤°à¥‹</span>
      <strong>Naya Patro v1.0</strong><br>
      Nepal Official Nepali Calendar<br>
      Raj Patra synced Â· Offline ready<br><br>
      Made with â¤ï¸ for Nepal ğŸ‡³ğŸ‡µ<br>
      <span style="color:var(--border);">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br>
      Â© 2082 BS | All holidays based on<br>Nepal Government Raj Patra
    </div>
  </div>

</div><!-- /app -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="bottom-nav">
  <div class="nav-item active" id="nav-home" onclick="showSection('sec-home'); setNav('nav-home')">
    <div class="nav-icon">ğŸ“…</div>
    <div class="nav-label">Calendar</div>
  </div>
  <div class="nav-item" id="nav-holidays" onclick="showSection('sec-holidays'); setNav('nav-holidays')">
    <div class="nav-icon">ğŸ‰</div>
    <div class="nav-label">Holidays</div>
  </div>
  <div class="nav-item" id="nav-reminders" onclick="showSection('sec-reminders'); setNav('nav-reminders')">
    <div class="nav-icon">â°</div>
    <div class="nav-label">Reminders</div>
  </div>
  <div class="nav-item" id="nav-rajpatra" onclick="showSection('sec-rajpatra'); setNav('nav-rajpatra')">
    <div class="nav-icon">ğŸ“‹</div>
    <div class="nav-label">Raj Patra</div>
  </div>
  <div class="nav-item" id="nav-more" onclick="showSection('sec-more'); setNav('nav-more')">
    <div class="nav-icon">âš™ï¸</div>
    <div class="nav-label">More</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• JAVASCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NEPALI CALENDAR DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const NP_MONTHS = ['à¤¬à¥ˆà¤¶à¤¾à¤–','à¤œà¥‡à¤ ','à¤…à¤¸à¤¾à¤°','à¤¶à¥à¤°à¤¾à¤µà¤£','à¤­à¤¾à¤¦à¥à¤°','à¤†à¤¶à¥à¤µà¤¿à¤¨','à¤•à¤¾à¤°à¥à¤¤à¤¿à¤•','à¤®à¤‚à¤¸à¤¿à¤°','à¤ªà¥à¤·','à¤®à¤¾à¤˜','à¤«à¤¾à¤²à¥à¤—à¥à¤¨','à¤šà¥ˆà¤¤'];
const NP_MONTHS_EN = ['Baisakh','Jestha','Ashar','Shrawan','Bhadra','Ashwin','Kartik','Mangsir','Poush','Magh','Falgun','Chaitra'];
const NP_DAYS = ['à¤†à¤‡à¤¤à¤¬à¤¾à¤°','à¤¸à¥‹à¤®à¤¬à¤¾à¤°','à¤®à¤‚à¤—à¤²à¤¬à¤¾à¤°','à¤¬à¥à¤§à¤¬à¤¾à¤°','à¤¬à¤¿à¤¹à¥€à¤¬à¤¾à¤°','à¤¶à¥à¤•à¥à¤°à¤¬à¤¾à¤°','à¤¶à¤¨à¤¿à¤¬à¤¾à¤°'];
const NP_DAYS_SHORT = ['à¤†à¤‡à¤¤','à¤¸à¥‹à¤®','à¤®à¤‚à¤—à¤²','à¤¬à¥à¤§','à¤¬à¤¿à¤¹à¥€','à¤¶à¥à¤•à¥à¤°','à¤¶à¤¨à¤¿'];
const NP_NUMS = ['à¥¦','à¥§','à¥¨','à¥©','à¥ª','à¥«','à¥¬','à¥­','à¥®','à¥¯'];

// Days in each Nepali month for 2082 BS
const MONTH_DAYS_2082 = [31,32,31,32,31,30,30,30,29,30,29,31]; // Approx
const MONTH_DAYS_2081 = [31,31,32,31,31,31,30,29,30,29,30,30];
const MONTH_DAYS_2083 = [31,31,32,32,31,30,30,29,30,29,30,30];

// BS to AD start mapping: 2082 BS starts April 14, 2025 AD
// 2082 Baisakh 1 = April 14, 2025
const BS_EPOCH = { year: 2082, month: 0, day: 1, adYear: 2025, adMonth: 3, adDay: 14 };

function toNepaliNum(n) {
  return String(n).split('').map(d => NP_NUMS[parseInt(d)] || d).join('');
}

// Simple BS<->AD conversion
function bsToAd(bsYear, bsMonth, bsDay) {
  let totalDays = 0;
  const epochAD = new Date(BS_EPOCH.adYear, BS_EPOCH.adMonth, BS_EPOCH.adDay);
  
  for (let y = BS_EPOCH.year; y < bsYear; y++) {
    const mdays = getMonthDays(y);
    for (let m = 0; m < 12; m++) totalDays += mdays[m];
  }
  const mdays = getMonthDays(bsYear);
  for (let m = 0; m < bsMonth; m++) totalDays += mdays[m];
  totalDays += bsDay - 1;
  if (bsYear === BS_EPOCH.year) {
    for (let m = 0; m < bsMonth; m++) totalDays += (m < BS_EPOCH.month ? 0 : 0);
  }
  const result = new Date(epochAD);
  result.setDate(result.getDate() + totalDays);
  return result;
}

function getMonthDays(year) {
  if (year === 2081) return MONTH_DAYS_2081;
  if (year === 2082) return MONTH_DAYS_2082;
  if (year === 2083) return MONTH_DAYS_2083;
  return MONTH_DAYS_2082; // fallback
}

// Get today's BS date
function getToday() {
  const today = new Date();
  return adToBs(today);
}

function adToBs(adDate) {
  const epochAD = new Date(BS_EPOCH.adYear, BS_EPOCH.adMonth, BS_EPOCH.adDay);
  const diffMs = adDate - epochAD;
  let diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
  
  let bsYear = BS_EPOCH.year;
  let bsMonth = 0;
  let bsDay = 1;
  
  if (diffDays < 0) {
    // Before epoch
    bsYear = 2081;
    let mdays = getMonthDays(2081);
    bsMonth = 11;
    bsDay = mdays[11] + diffDays + 1; 
    if (bsDay < 1) { bsMonth--; bsDay += mdays[bsMonth]; }
    return { year: bsYear, month: bsMonth, day: bsDay };
  }
  
  while (true) {
    const mdays = getMonthDays(bsYear);
    const daysInYear = mdays.reduce((a,b)=>a+b,0);
    if (diffDays < daysInYear) break;
    diffDays -= daysInYear;
    bsYear++;
  }
  
  const mdays = getMonthDays(bsYear);
  while (diffDays >= mdays[bsMonth]) {
    diffDays -= mdays[bsMonth];
    bsMonth++;
    if (bsMonth >= 12) { bsMonth = 0; bsYear++; }
  }
  bsDay = diffDays + 1;
  
  return { year: bsYear, month: bsMonth, day: bsDay };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NEPAL HOLIDAYS 2082 BS
   (Official Raj Patra based)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const HOLIDAYS_2082 = [
  // Public Holidays (Rajpatra)
  { month:0, day:1,  name:"Nepali New Year", nameNe:"à¤¨à¤¯à¤¾à¤ à¤µà¤°à¥à¤·", type:"rajpatra", icon:"ğŸ†" },
  { month:1, day:15, name:"Buddha Jayanti", nameNe:"à¤¬à¥à¤¦à¥à¤§ à¤œà¤¯à¤¨à¥à¤¤à¥€", type:"rajpatra", icon:"â˜¸ï¸" },
  { month:1, day:29, name:"Republic Day", nameNe:"à¤—à¤£à¤¤à¤¨à¥à¤¤à¥à¤° à¤¦à¤¿à¤µà¤¸", type:"rajpatra", icon:"ğŸ‡³ğŸ‡µ" },
  { month:2, day:15, name:"Tribhuvan Jayanti", nameNe:"à¤¤à¥à¤°à¤¿à¤­à¥à¤µà¤¨ à¤œà¤¯à¤¨à¥à¤¤à¥€", type:"rajpatra", icon:"ğŸ‘‘" },
  { month:4, day:21, name:"Constitution Day", nameNe:"à¤¸à¤‚à¤µà¤¿à¤§à¤¾à¤¨ à¤¦à¤¿à¤µà¤¸", type:"rajpatra", icon:"ğŸ“œ" },
  { month:5, day:19, name:"National Unity Day", nameNe:"à¤°à¤¾à¤·à¥à¤Ÿà¥à¤°à¤¿à¤¯ à¤à¤•à¤¤à¤¾ à¤¦à¤¿à¤µà¤¸", type:"rajpatra", icon:"ğŸ¤" },
  { month:6, day:1,  name:"Ghatasthapana", nameNe:"à¤˜à¤Ÿà¤¸à¥à¤¥à¤¾à¤ªà¤¨à¤¾", type:"rajpatra", icon:"ğŸº" },
  { month:6, day:9,  name:"Phulpati", nameNe:"à¤«à¥‚à¤²à¤ªà¤¾à¤¤à¥€", type:"rajpatra", icon:"ğŸŒº" },
  { month:6, day:10, name:"Maha Ashtami", nameNe:"à¤®à¤¹à¤¾à¤…à¤·à¥à¤Ÿà¤®à¥€", type:"rajpatra", icon:"ğŸ­" },
  { month:6, day:11, name:"Maha Nawami", nameNe:"à¤®à¤¹à¤¾à¤¨à¤µà¤®à¥€", type:"rajpatra", icon:"âš”ï¸" },
  { month:6, day:12, name:"Vijaya Dashami", nameNe:"à¤µà¤¿à¤œà¤¯à¤¾ à¤¦à¤¶à¤®à¥€", type:"rajpatra", icon:"ğŸ‰" },
  { month:6, day:13, name:"Ekadashi", nameNe:"à¤à¤•à¤¾à¤¦à¤¶à¥€", type:"festival", icon:"ğŸ™" },
  { month:7, day:1,  name:"Laxmi Puja (Tihar)", nameNe:"à¤²à¤•à¥à¤·à¥à¤®à¥€ à¤ªà¥‚à¤œà¤¾", type:"rajpatra", icon:"ğŸª”" },
  { month:7, day:2,  name:"Gobardhan Puja", nameNe:"à¤—à¥‹à¤µà¤°à¥à¤§à¤¨ à¤ªà¥‚à¤œà¤¾", type:"rajpatra", icon:"ğŸ„" },
  { month:7, day:3,  name:"Bhai Tika", nameNe:"à¤­à¤¾à¤‡à¤Ÿà¥€à¤•à¤¾", type:"rajpatra", icon:"ğŸ’" },
  { month:8, day:1,  name:"Udhauli Parwa", nameNe:"à¤‰à¤§à¥Œà¤²à¥€ à¤ªà¤°à¥à¤µ", type:"festival", icon:"ğŸŒ¾" },
  { month:8, day:30, name:"Yomari Punhi", nameNe:"à¤¯à¥‹à¤®à¤°à¥€ à¤ªà¥à¤¨à¥à¤¹à¥€", type:"festival", icon:"ğŸ¢" },
  { month:9, day:15, name:"Maghe Sankranti", nameNe:"à¤®à¤¾à¤˜à¥‡ à¤¸à¤‚à¤•à¥à¤°à¤¾à¤¨à¥à¤¤à¤¿", type:"rajpatra", icon:"â˜€ï¸" },
  { month:10, day:19, name:"Maha Shivaratri", nameNe:"à¤®à¤¹à¤¾à¤¶à¤¿à¤µà¤°à¤¾à¤¤à¥à¤°à¥€", type:"rajpatra", icon:"ğŸ”±" },
  { month:11, day:1, name:"Fagu Purnima (Holi)", nameNe:"à¤«à¤¾à¤—à¥ à¤ªà¥‚à¤°à¥à¤£à¤¿à¤®à¤¾", type:"rajpatra", icon:"ğŸ¨" },
  // Special days
  { month:0, day:17, name:"Mata Tirtha Aunsi", nameNe:"à¤®à¤¾à¤¤à¤¾à¤¤à¥€à¤°à¥à¤¥ à¤”à¤‚à¤¸à¥€", type:"festival", icon:"ğŸŒ¹" },
  { month:1, day:1,  name:"Father's Day", nameNe:"à¤¬à¥à¤µà¤¾à¤•à¥‹ à¤®à¥à¤– à¤¹à¥‡à¤°à¥à¤¨à¥‡ à¤¦à¤¿à¤¨", type:"festival", icon:"ğŸ‘¨â€ğŸ‘¦" },
  { month:3, day:1,  name:"Janai Purnima", nameNe:"à¤œà¤¨à¥ˆ à¤ªà¥‚à¤°à¥à¤£à¤¿à¤®à¤¾", type:"festival", icon:"ğŸ§µ" },
  { month:3, day:4,  name:"Krishna Janmashtami", nameNe:"à¤•à¥ƒà¤·à¥à¤£ à¤œà¤¨à¥à¤®à¤¾à¤·à¥à¤Ÿà¤®à¥€", type:"festival", icon:"ğŸ¦š" },
  { month:3, day:5,  name:"Gai Jatra", nameNe:"à¤—à¤¾à¤ˆ à¤œà¤¾à¤¤à¥à¤°à¤¾", type:"festival", icon:"ğŸ‚" },
  { month:3, day:11, name:"Indra Jatra", nameNe:"à¤‡à¤¨à¥à¤¦à¥à¤° à¤œà¤¾à¤¤à¥à¤°à¤¾", type:"festival", icon:"ğŸ­" },
  { month:4, day:6,  name:"Dashain Begins", nameNe:"à¤˜à¤Ÿà¤¸à¥à¤¥à¤¾à¤ªà¤¨à¤¾", type:"festival", icon:"â›º" },
  { month:9, day:1,  name:"Prithvi Jayanti", nameNe:"à¤ªà¥ƒà¤¥à¥à¤µà¥€ à¤œà¤¯à¤¨à¥à¤¤à¥€", type:"rajpatra", icon:"ğŸŒ" },
  { month:10, day:7, name:"Democracy Day", nameNe:"à¤ªà¥à¤°à¤œà¤¾à¤¤à¤¨à¥à¤¤à¥à¤° à¤¦à¤¿à¤µà¤¸", type:"rajpatra", icon:"ğŸ—³ï¸" },
  { month:11, day:16, name:"Ghode Jatra", nameNe:"à¤˜à¥‹à¤¡à¥‡ à¤œà¤¾à¤¤à¥à¤°à¤¾", type:"festival", icon:"ğŸ´" },
];

// Also store custom holidays (from user input or "Raj Patra sync")
let customHolidays = JSON.parse(localStorage.getItem('customHolidays') || '[]');

function getAllHolidays() {
  return [...HOLIDAYS_2082, ...customHolidays];
}

function getHolidayForDate(bsYear, bsMonth, bsDay) {
  if (bsYear !== 2082) return null;
  return getAllHolidays().filter(h => h.month === bsMonth && h.day === bsDay);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANCHANG DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const TITHIS = ['à¤ªà¥à¤°à¤¤à¤¿à¤ªà¤¦à¤¾','à¤¦à¥à¤µà¤¿à¤¤à¥€à¤¯à¤¾','à¤¤à¥ƒà¤¤à¥€à¤¯à¤¾','à¤šà¤¤à¥à¤°à¥à¤¥à¥€','à¤ªà¤à¥à¤šà¤®à¥€','à¤·à¤·à¥à¤ à¥€','à¤¸à¤ªà¥à¤¤à¤®à¥€','à¤…à¤·à¥à¤Ÿà¤®à¥€','à¤¨à¤µà¤®à¥€','à¤¦à¤¶à¤®à¥€','à¤à¤•à¤¾à¤¦à¤¶à¥€','à¤¦à¥à¤µà¤¾à¤¦à¤¶à¥€','à¤¤à¥à¤°à¤¯à¥‹à¤¦à¤¶à¥€','à¤šà¤¤à¥à¤°à¥à¤¦à¤¶à¥€','à¤ªà¥‚à¤°à¥à¤£à¤¿à¤®à¤¾/à¤”à¤‚à¤¸à¥€'];
const NAKSHATRAS = ['à¤…à¤¶à¥à¤µà¤¿à¤¨à¥€','à¤­à¤°à¤£à¥€','à¤•à¥ƒà¤¤à¥à¤¤à¤¿à¤•à¤¾','à¤°à¥‹à¤¹à¤¿à¤£à¥€','à¤®à¥ƒà¤—à¤¶à¤¿à¤°à¤¾','à¤†à¤°à¥à¤¦à¥à¤°à¤¾','à¤ªà¥à¤¨à¤°à¥à¤µà¤¸à¥','à¤ªà¥à¤·à¥à¤¯','à¤†à¤¶à¥à¤²à¥‡à¤·à¤¾','à¤®à¤˜à¤¾','à¤ªà¥‚à¤°à¥à¤µà¤¾à¤«à¤¾à¤²à¥à¤—à¥à¤¨à¥€','à¤‰à¤¤à¥à¤¤à¤°à¤¾à¤«à¤¾à¤²à¥à¤—à¥à¤¨à¥€','à¤¹à¤¸à¥à¤¤','à¤šà¤¿à¤¤à¥à¤°à¤¾','à¤¸à¥à¤µà¤¾à¤¤à¥€','à¤µà¤¿à¤¶à¤¾à¤–à¤¾','à¤…à¤¨à¥à¤°à¤¾à¤§à¤¾','à¤œà¥à¤¯à¥‡à¤·à¥à¤ à¤¾','à¤®à¥‚à¤²','à¤ªà¥‚à¤°à¥à¤µà¤¾à¤·à¤¾à¤¢à¤¼à¤¾','à¤‰à¤¤à¥à¤¤à¤°à¤¾à¤·à¤¾à¤¢à¤¼à¤¾','à¤¶à¥à¤°à¤µà¤£','à¤§à¤¨à¤¿à¤·à¥à¤ à¤¾','à¤¶à¤¤à¤­à¤¿à¤·à¤¾','à¤ªà¥‚à¤°à¥à¤µà¤¾à¤­à¤¾à¤¦à¥à¤°à¤ªà¤¦','à¤‰à¤¤à¥à¤¤à¤°à¤¾à¤­à¤¾à¤¦à¥à¤°à¤ªà¤¦','à¤°à¥‡à¤µà¤¤à¥€'];
const YOGAS = ['à¤µà¤¿à¤·à¥à¤•à¥à¤®à¥à¤­','à¤ªà¥à¤°à¥€à¤¤à¤¿','à¤†à¤¯à¥à¤·à¥à¤®à¤¾à¤¨','à¤¸à¥Œà¤­à¤¾à¤—à¥à¤¯','à¤¶à¥‹à¤­à¤¨','à¤…à¤¤à¤¿à¤—à¤£à¥à¤¡','à¤¸à¥à¤•à¤°à¥à¤®','à¤§à¥ƒà¤¤à¤¿','à¤¶à¥‚à¤²','à¤—à¤£à¥à¤¡','à¤µà¥ƒà¤¦à¥à¤§à¤¿','à¤§à¥à¤°à¥à¤µ','à¤µà¥à¤¯à¤¾à¤˜à¤¾à¤¤','à¤¹à¤°à¥à¤·à¤£','à¤µà¤œà¥à¤°','à¤¸à¤¿à¤¦à¥à¤§à¤¿','à¤µà¥à¤¯à¤¤à¥€à¤ªà¤¾à¤¤','à¤µà¤°à¥€à¤¯à¤¾à¤¨','à¤ªà¤°à¤¿à¤˜','à¤¶à¤¿à¤µ','à¤¸à¤¿à¤¦à¥à¤§','à¤¸à¤¾à¤§à¥à¤¯','à¤¶à¥à¤­','à¤¶à¥à¤•à¥à¤²','à¤¬à¥à¤°à¤¹à¥à¤®','à¤‡à¤¨à¥à¤¦à¥à¤°','à¤µà¥ˆà¤§à¥ƒà¤¤à¤¿'];
const KARANAS = ['à¤¬à¤µ','à¤¬à¤¾à¤²à¤µ','à¤•à¥Œà¤²à¤µ','à¤¤à¥ˆà¤¤à¤¿à¤²','à¤—à¤°','à¤µà¤£à¤¿à¤œ','à¤µà¤¿à¤·à¥à¤Ÿà¤¿'];
const RASIS = ['à¤®à¥‡à¤·','à¤µà¥ƒà¤·','à¤®à¤¿à¤¥à¥à¤¨','à¤•à¤°à¥à¤•à¤Ÿ','à¤¸à¤¿à¤‚à¤¹','à¤•à¤¨à¥à¤¯à¤¾','à¤¤à¥à¤²à¤¾','à¤µà¥ƒà¤¶à¥à¤šà¤¿à¤•','à¤§à¤¨à¥','à¤®à¤•à¤°','à¤•à¥à¤®à¥à¤­','à¤®à¥€à¤¨'];

function getPanchaData(date) {
  const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / 86400000);
  return {
    tithi: TITHIS[dayOfYear % 15],
    nakshatra: NAKSHATRAS[dayOfYear % 27],
    yoga: YOGAS[dayOfYear % 27],
    karana: KARANAS[dayOfYear % 7],
    rasi: RASIS[Math.floor(dayOfYear / 30) % 12],
    samvat: 'à¥¨à¥¦à¥®à¥¨'
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentBsYear = 2082;
let currentBsMonth = 0;
let todayBs = null;
let reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
let notifications = JSON.parse(localStorage.getItem('notifications') || '[]');
let deferredInstall = null;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function init() {
  todayBs = getToday();
  currentBsYear = todayBs.year;
  currentBsMonth = todayBs.month;
  
  updateTodayBanner();
  renderCalendar();
  renderUpcomingStrip();
  renderPanchang();
  renderHolidayList();
  renderReminderList();
  renderRajpatraList();
  renderNotifications();
  updateStats();
  loadSettings();
  checkDailyNotif();
  
  // Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(()=>{});
  }
  
  // Notif status
  updateNotifStatus();
}

function updateTodayBanner() {
  const today = new Date();
  const bs = todayBs;
  document.getElementById('todayBsNum').textContent = toNepaliNum(bs.day);
  document.getElementById('todayBsSub').textContent = NP_MONTHS[bs.month] + ' ' + toNepaliNum(bs.year) + ' â€¢ ' + NP_MONTHS_EN[bs.month];
  document.getElementById('todayWeekday').textContent = NP_DAYS[today.getDay()];
  document.getElementById('todayEnDate').textContent = today.toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'});
  
  const panch = getPanchaData(today);
  document.getElementById('todayTithi').textContent = panch.tithi + ' â€¢ ' + panch.nakshatra;
  
  const holidays = getHolidayForDate(bs.year, bs.month, bs.day);
  const chipEl = document.getElementById('todayHolidayChip');
  if (holidays && holidays.length) {
    chipEl.innerHTML = holidays.map(h=>`<div class="today-holiday-chip">${h.icon} ${h.name}</div>`).join('');
  } else {
    chipEl.innerHTML = '';
  }
}

function renderPanchang() {
  const today = new Date();
  const p = getPanchaData(today);
  document.getElementById('panchaGrid').innerHTML = `
    <div class="panch-item"><div class="panch-lbl">à¤¤à¤¿à¤¥à¤¿</div><div class="panch-val">${p.tithi}</div></div>
    <div class="panch-item"><div class="panch-lbl">à¤¨à¤•à¥à¤·à¤¤à¥à¤°</div><div class="panch-val">${p.nakshatra}</div></div>
    <div class="panch-item"><div class="panch-lbl">à¤¯à¥‹à¤—</div><div class="panch-val">${p.yoga}</div></div>
    <div class="panch-item"><div class="panch-lbl">à¤•à¤°à¤£</div><div class="panch-val">${p.karana}</div></div>
    <div class="panch-item"><div class="panch-lbl">à¤°à¤¾à¤¶à¤¿</div><div class="panch-val">${p.rasi}</div></div>
    <div class="panch-item"><div class="panch-lbl">à¤¸à¤®à¥à¤µà¤¤à¥</div><div class="panch-val">${p.samvat}</div></div>
  `;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDAR RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderCalendar() {
  document.getElementById('calMonthNe').textContent = NP_MONTHS[currentBsMonth] + ' ' + toNepaliNum(currentBsYear);
  document.getElementById('calMonthEn').textContent = NP_MONTHS_EN[currentBsMonth] + ' ' + currentBsYear;
  
  const mdays = getMonthDays(currentBsYear);
  const daysInMonth = mdays[currentBsMonth];
  
  // Get what AD date is month start
  const monthStartAd = bsToAd(currentBsYear, currentBsMonth, 1);
  const startDow = monthStartAd.getDay(); // 0=Sun
  
  let html = '';
  
  // Previous month filler
  let prevMonthDays = currentBsMonth > 0 ? mdays[currentBsMonth - 1] : getMonthDays(currentBsYear - 1)[11];
  for (let i = 0; i < startDow; i++) {
    const prevDay = prevMonthDays - startDow + i + 1;
    html += `<div class="day-cell other-month">
      <div class="bs-num">${toNepaliNum(prevDay)}</div>
    </div>`;
  }
  
  // Current month days
  let adDatePointer = new Date(monthStartAd);
  for (let d = 1; d <= daysInMonth; d++) {
    const dow = adDatePointer.getDay();
    const isSun = dow === 0;
    const isSat = dow === 6;
    const isToday = todayBs && currentBsYear === todayBs.year && currentBsMonth === todayBs.month && d === todayBs.day;
    const holidays = getHolidayForDate(currentBsYear, currentBsMonth, d);
    const isHoliday = holidays && holidays.length > 0;
    const hasReminder = reminders.some(r => {
      const rd = new Date(r.date);
      return rd.getDate() === adDatePointer.getDate() && rd.getMonth() === adDatePointer.getMonth() && rd.getFullYear() === adDatePointer.getFullYear();
    });
    
    let classes = 'day-cell';
    if (isSun) classes += ' sun';
    if (isSat) classes += ' sat';
    if (isToday) classes += ' today';
    if (isHoliday) classes += ' holiday';
    
    const enDay = adDatePointer.getDate();
    const showAd = document.getElementById('adToggle')?.classList.contains('on');
    
    html += `<div class="${classes}" onclick="openDayDetail(${currentBsYear},${currentBsMonth},${d},'${dow}')">
      <div class="bs-num">${toNepaliNum(d)}</div>
      <div class="en-num">${enDay}</div>
      ${isHoliday ? `<div class="holiday-name-tiny">${holidays[0].icon}</div>` : ''}
      ${hasReminder ? '<div class="event-dot"></div>' : ''}
    </div>`;
    
    adDatePointer.setDate(adDatePointer.getDate() + 1);
  }
  
  // Fill remaining
  let total = startDow + daysInMonth;
  let nextDay = 1;
  while (total % 7 !== 0) {
    html += `<div class="day-cell other-month"><div class="bs-num">${toNepaliNum(nextDay)}</div></div>`;
    total++; nextDay++;
  }
  
  document.getElementById('calDays').innerHTML = html;
}

function prevMonth() {
  currentBsMonth--;
  if (currentBsMonth < 0) { currentBsMonth = 11; currentBsYear--; }
  renderCalendar();
}

function nextMonth() {
  currentBsMonth++;
  if (currentBsMonth > 11) { currentBsMonth = 0; currentBsYear++; }
  renderCalendar();
}

function goToToday() {
  currentBsYear = todayBs.year;
  currentBsMonth = todayBs.month;
  renderCalendar();
  showSection('sec-home');
  setNav('nav-home');
  showToast('ğŸ“… Today: ' + toNepaliNum(todayBs.day) + ' ' + NP_MONTHS[todayBs.month]);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPCOMING STRIP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderUpcomingStrip() {
  const today = todayBs;
  const upcoming = getAllHolidays()
    .filter(h => {
      if (h.month > today.month) return true;
      if (h.month === today.month && h.day > today.day) return true;
      return false;
    })
    .sort((a,b) => a.month !== b.month ? a.month-b.month : a.day-b.day)
    .slice(0, 8);
  
  let html = '';
  upcoming.forEach(h => {
    const targetAd = bsToAd(2082, h.month, h.day);
    const todayAd = new Date();
    todayAd.setHours(0,0,0,0);
    const daysLeft = Math.round((targetAd - todayAd) / 86400000);
    html += `<div class="upcoming-chip" onclick="openDayDetail(2082,${h.month},${h.day},null)">
      <div class="uc-days">${daysLeft === 0 ? 'TODAY' : daysLeft + ' days'}</div>
      <div class="uc-name">${h.icon} ${h.name}</div>
      <div class="uc-date">${toNepaliNum(h.day)} ${NP_MONTHS[h.month]}</div>
    </div>`;
  });
  document.getElementById('upcomingStrip').innerHTML = html || '<div style="color:var(--text3);padding:10px;font-size:13px;">No upcoming holidays this year</div>';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DAY DETAIL MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDayDetail(bsYear, bsMonth, bsDay, dow) {
  const adDate = bsToAd(bsYear, bsMonth, bsDay);
  const holidays = getHolidayForDate(bsYear, bsMonth, bsDay);
  const panch = getPanchaData(adDate);
  const dowIdx = dow !== null ? parseInt(dow) : adDate.getDay();
  const isToday = todayBs && bsYear === todayBs.year && bsMonth === todayBs.month && bsDay === todayBs.day;
  
  // Day's reminders
  const dayRems = reminders.filter(r => {
    const rd = new Date(r.date);
    return rd.toDateString() === adDate.toDateString();
  });
  
  let holidayHtml = '';
  if (holidays && holidays.length) {
    holidayHtml = `<div class="detail-section">
      <div class="detail-sec-title">ğŸ‰ Holidays / Events</div>
      ${holidays.map(h=>`
        <div class="holiday-item">
          <div class="holiday-item-icon">${h.icon}</div>
          <div>
            <div class="holiday-item-name">${h.name}</div>
            <div class="holiday-item-type" style="font-family:'Tiro Devanagari Hindi',serif;">${h.nameNe}</div>
            <div class="holiday-item-type">${h.type === 'rajpatra' ? 'ğŸ“‹ Official Raj Patra Holiday' : 'ğŸŠ Festival / Cultural'}</div>
          </div>
        </div>`).join('')}
    </div>`;
  }
  
  let remHtml = '';
  if (dayRems.length) {
    remHtml = `<div class="detail-section">
      <div class="detail-sec-title">â° Your Reminders</div>
      ${dayRems.map(r=>`
        <div class="holiday-item" style="border-color:rgba(217,119,6,0.3);background:rgba(217,119,6,0.07);">
          <div class="holiday-item-icon">${getReminderIcon(r.type)}</div>
          <div>
            <div class="holiday-item-name" style="color:var(--gold-light);">${r.title}</div>
            <div class="holiday-item-type">${r.time || 'All day'}${r.note ? ' Â· ' + r.note : ''}</div>
          </div>
        </div>`).join('')}
    </div>`;
  }
  
  document.getElementById('modalContent').innerHTML = `
    <div class="detail-head">
      <div class="detail-bs-big" style="${holidays?.length ? 'color:var(--sun);' : ''}">${toNepaliNum(bsDay)}</div>
      <div class="detail-info">
        <div class="detail-weekday" style="${dowIdx===0?'color:var(--sun);':dowIdx===6?'color:var(--sat)':''}">${NP_DAYS[dowIdx]}</div>
        <div class="detail-month-year">${NP_MONTHS[bsMonth]} ${toNepaliNum(bsYear)} BS</div>
        <div class="detail-en">${adDate.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'})}</div>
        ${isToday ? '<div class="today-holiday-chip" style="margin-top:6px;">â— Today</div>' : ''}
        ${holidays?.length ? '<div class="today-holiday-chip">ğŸ‰ Holiday</div>' : ''}
      </div>
    </div>
    ${holidayHtml}
    ${remHtml}
    <div class="detail-section">
      <div class="detail-sec-title">ğŸ“¿ Panchang</div>
      <div class="tithi-row">
        <div class="tithi-box"><div class="tithi-label">à¤¤à¤¿à¤¥à¤¿</div><div class="tithi-val">${panch.tithi}</div></div>
        <div class="tithi-box"><div class="tithi-label">à¤¨à¤•à¥à¤·à¤¤à¥à¤°</div><div class="tithi-val">${panch.nakshatra}</div></div>
        <div class="tithi-box"><div class="tithi-label">à¤¯à¥‹à¤—</div><div class="tithi-val">${panch.yoga}</div></div>
        <div class="tithi-box"><div class="tithi-label">à¤•à¤°à¤£</div><div class="tithi-val">${panch.karana}</div></div>
      </div>
    </div>
    <div class="detail-section">
      <div class="detail-sec-title">â• Actions</div>
      <button class="add-event-btn" onclick="quickAddReminder(${bsYear},${bsMonth},${bsDay},'${adDate.toISOString().split('T')[0]}')">
        â° Add Reminder for this day
      </button>
      <button class="add-event-btn" onclick="shareDate(${bsYear},${bsMonth},${bsDay})" style="margin-top:6px;">
        ğŸ”— Share this date
      </button>
    </div>
  `;
  
  document.getElementById('detailModal').classList.add('open');
}

function closeModal(e) {
  if (e.target === document.getElementById('detailModal')) closeDetailModal();
}
function closeDetailModal() {
  document.getElementById('detailModal').classList.remove('open');
}

function quickAddReminder(bsY, bsM, bsD, adDateStr) {
  closeDetailModal();
  showSection('sec-reminders');
  setNav('nav-reminders');
  document.getElementById('remDate').value = adDateStr;
  document.getElementById('remTitle').focus();
  showToast('ğŸ“… Date set! Add reminder title.');
}

function shareDate(y, m, d) {
  const text = `${toNepaliNum(d)} ${NP_MONTHS[m]} ${toNepaliNum(y)} BS â€“ Naya Patro ğŸ‡³ğŸ‡µ`;
  if (navigator.share) navigator.share({ title:'Naya Patro', text });
  else { navigator.clipboard?.writeText(text); showToast('ğŸ“‹ Copied!'); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HOLIDAY LIST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderHolidayList() {
  const byMonth = {};
  getAllHolidays().forEach(h => {
    if (!byMonth[h.month]) byMonth[h.month] = [];
    byMonth[h.month].push(h);
  });
  
  let html = '';
  for (let m = 0; m < 12; m++) {
    if (!byMonth[m]) continue;
    byMonth[m].sort((a,b) => a.day - b.day);
    html += `<div class="month-group">
      <div class="month-group-title">${NP_MONTHS[m]} ${toNepaliNum(m+1)} â€” ${NP_MONTHS_EN[m]}</div>
      ${byMonth[m].map(h=>{
        const adDate = bsToAd(2082, h.month, h.day);
        return `<div class="holiday-card ${h.type}" onclick="openDayDetail(2082,${h.month},${h.day},${adDate.getDay()})">
          <div class="hc-date-box">
            <div class="hc-bs">${toNepaliNum(h.day)}</div>
            <div class="hc-month">${NP_MONTHS_EN[h.month].toUpperCase().slice(0,3)}</div>
          </div>
          <div class="hc-info">
            <div class="hc-name">${h.icon} ${h.name}</div>
            <div class="hc-name-ne">${h.nameNe}</div>
          </div>
          <div><span class="hc-badge ${h.type === 'rajpatra' ? 'badge-rajpatra' : 'badge-festival'}">${h.type === 'rajpatra' ? 'RAJ PATRA' : 'FESTIVAL'}</span></div>
        </div>`;
      }).join('')}
    </div>`;
  }
  document.getElementById('holidayList').innerHTML = html;
  document.getElementById('statHolidays').textContent = getAllHolidays().length;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REMINDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getReminderIcon(type) {
  const icons = { personal:'ğŸ‘¤', work:'ğŸ’¼', health:'ğŸ¥', festival:'ğŸŠ', birthday:'ğŸ‚', anniversary:'ğŸ’‘', other:'ğŸ“Œ' };
  return icons[type] || 'ğŸ“Œ';
}

function addReminder() {
  const title = document.getElementById('remTitle').value.trim();
  const date = document.getElementById('remDate').value;
  const time = document.getElementById('remTime').value;
  const type = document.getElementById('remType').value;
  const note = document.getElementById('remNote').value.trim();
  const notify = document.getElementById('remNotifToggle').classList.contains('on');
  
  if (!title) { showToast('âš ï¸ Please enter a title'); return; }
  if (!date) { showToast('âš ï¸ Please select a date'); return; }
  
  const rem = { id: Date.now(), title, date, time, type, note, notify, created: new Date().toISOString() };
  reminders.push(rem);
  reminders.sort((a,b) => new Date(a.date) - new Date(b.date));
  localStorage.setItem('reminders', JSON.stringify(reminders));
  
  // Schedule notification
  if (notify) scheduleReminderNotif(rem);
  
  // Clear form
  document.getElementById('remTitle').value = '';
  document.getElementById('remDate').value = '';
  document.getElementById('remTime').value = '';
  document.getElementById('remNote').value = '';
  
  renderReminderList();
  updateStats();
  renderCalendar();
  showToast('âœ… Reminder saved!');
  
  // Add to in-app notifications
  addNotification('â° Reminder Added', `"${title}" on ${new Date(date).toLocaleDateString('en-US',{month:'short',day:'numeric'})}`);
}

function deleteReminder(id) {
  reminders = reminders.filter(r => r.id !== id);
  localStorage.setItem('reminders', JSON.stringify(reminders));
  renderReminderList();
  updateStats();
  renderCalendar();
  showToast('ğŸ—‘ï¸ Reminder deleted');
}

function renderReminderList() {
  const today = new Date(); today.setHours(0,0,0,0);
  
  const upcoming = reminders.filter(r => new Date(r.date) >= today);
  const past = reminders.filter(r => new Date(r.date) < today);
  
  let html = '';
  
  if (upcoming.length === 0 && past.length === 0) {
    html = `<div style="text-align:center;padding:30px;color:var(--text3);">
      <div style="font-size:40px;margin-bottom:8px;">â°</div>
      <div>No reminders yet.<br>Add one above!</div>
    </div>`;
  } else {
    if (upcoming.length) {
      html += `<div class="upcoming-title" style="margin-bottom:8px;">ğŸ“Œ UPCOMING</div>`;
      html += upcoming.map(r => reminderItemHtml(r)).join('');
    }
    if (past.length) {
      html += `<div class="upcoming-title" style="margin:12px 0 8px;color:var(--text3);">âœ“ PAST</div>`;
      html += past.map(r => reminderItemHtml(r, true)).join('');
    }
  }
  
  document.getElementById('reminderList').innerHTML = html;
  document.getElementById('statReminders').textContent = upcoming.length;
}

function reminderItemHtml(r, isPast = false) {
  const d = new Date(r.date);
  const today = new Date(); today.setHours(0,0,0,0);
  const daysLeft = Math.round((d - today) / 86400000);
  const daysText = daysLeft === 0 ? 'Today!' : daysLeft === 1 ? 'Tomorrow' : isPast ? d.toLocaleDateString('en-US',{month:'short',day:'numeric'}) : `In ${daysLeft} days`;
  
  return `<div class="reminder-item" style="${isPast?'opacity:0.5;':''}">
    <div class="reminder-icon">${getReminderIcon(r.type)}</div>
    <div class="reminder-info">
      <div class="reminder-title">${r.title}</div>
      <div class="reminder-meta">${daysText} Â· ${d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})}${r.time ? ' at ' + r.time : ''}${r.note ? ' Â· ' + r.note : ''}</div>
    </div>
    <button class="reminder-del" onclick="deleteReminder(${r.id})">ğŸ—‘ï¸</button>
  </div>`;
}

function scheduleReminderNotif(rem) {
  if (!('Notification' in window)) return;
  if (Notification.permission !== 'granted') return;
  
  const remDate = new Date(rem.date + (rem.time ? 'T' + rem.time : 'T09:00'));
  const notifTime = new Date(remDate);
  notifTime.setDate(notifTime.getDate() - 1);
  notifTime.setHours(8, 0, 0, 0);
  
  const now = new Date();
  const delay = notifTime - now;
  if (delay > 0 && delay < 86400000 * 7) {
    setTimeout(() => {
      new Notification('Naya Patro â°', {
        body: `Tomorrow: ${rem.title}`,
        icon: 'icon-192.png'
      });
    }, delay);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RAJ PATRA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const RAJPATRA_NOTICES = [
  { title: "Public Holiday: Vijaya Dashami 2082", date: "Oct 2025", type: "new", source: "rajpatra.dop.gov.np" },
  { title: "Tihar Public Holidays 3 Days 2082", date: "Oct 2025", type: "new", source: "rajpatra.dop.gov.np" },
  { title: "Republic Day 2082 â€“ Official Holiday", date: "May 2025", type: "old", source: "rajpatra.dop.gov.np" },
  { title: "Nepali New Year 2082 â€“ Holiday Declared", date: "Apr 2025", type: "old", source: "rajpatra.dop.gov.np" },
  { title: "Shivaratri 2082 â€“ Government Holiday", date: "Feb 2025", type: "old", source: "rajpatra.dop.gov.np" },
];

function renderRajpatraList() {
  document.getElementById('rajpatraList').innerHTML = RAJPATRA_NOTICES.map(n => `
    <div class="rp-item">
      <div class="rp-dot ${n.type}"></div>
      <div class="rp-item-info">
        <div class="rp-item-title">${n.title}</div>
        <div class="rp-item-date">${n.date}</div>
        <a class="rp-item-source" href="https://${n.source}" target="_blank">ğŸ“ ${n.source}</a>
      </div>
    </div>
  `).join('');
}

function manualRefreshHolidays() {
  showToast('ğŸ”„ Holidays are up to date!');
  addNotification('ğŸ“‹ Raj Patra', 'All holidays are synced with official Raj Patra 2082 BS.');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addNotification(title, body) {
  const n = { id: Date.now(), title, body, time: new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'}), read: false };
  notifications.unshift(n);
  if (notifications.length > 50) notifications.pop();
  localStorage.setItem('notifications', JSON.stringify(notifications));
  renderNotifications();
}

function renderNotifications() {
  const unread = notifications.filter(n => !n.read).length;
  document.getElementById('notifDot').style.display = unread ? 'block' : 'none';
  
  document.getElementById('notifList').innerHTML = notifications.length ? 
    notifications.map(n => `
      <div class="notif-item ${n.read?'':'unread'}" onclick="markRead(${n.id})">
        <div class="notif-item-icon">ğŸ””</div>
        <div class="notif-item-content">
          <div class="notif-item-title">${n.title}</div>
          <div class="notif-item-body">${n.body}</div>
          <div class="notif-item-time">${n.time}</div>
        </div>
      </div>`).join('') :
    '<div style="padding:30px;text-align:center;color:var(--text3);">No notifications yet ğŸ”•</div>';
}

function markRead(id) {
  notifications = notifications.map(n => n.id === id ? {...n, read:true} : n);
  localStorage.setItem('notifications', JSON.stringify(notifications));
  renderNotifications();
}

function toggleNotifPanel() {
  const panel = document.getElementById('notifPanel');
  panel.classList.toggle('open');
  if (panel.classList.contains('open')) {
    // Mark all read
    setTimeout(() => {
      notifications = notifications.map(n=>({...n,read:true}));
      localStorage.setItem('notifications', JSON.stringify(notifications));
      renderNotifications();
    }, 2000);
  }
}

function closeNotifPanel() {
  document.getElementById('notifPanel').classList.remove('open');
}

function checkDailyNotif() {
  const lastCheck = localStorage.getItem('lastNotifCheck');
  const today = new Date().toDateString();
  if (lastCheck === today) return;
  localStorage.setItem('lastNotifCheck', today);
  
  // Check tomorrow's holidays
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  const tmBs = adToBs(tomorrow);
  const tmHolidays = getHolidayForDate(tmBs.year, tmBs.month, tmBs.day);
  if (tmHolidays && tmHolidays.length) {
    tmHolidays.forEach(h => {
      addNotification('ğŸ‰ Holiday Tomorrow!', `${h.nameNe} â€“ ${h.name}`);
      if (Notification.permission === 'granted') {
        new Notification('Naya Patro â€“ Holiday Tomorrow! ğŸ‰', { body: h.name + ' â€“ ' + h.nameNe });
      }
    });
  }
  
  // Morning greeting
  addNotification('ğŸŒ… Good Morning!', `Today: ${NP_DAYS[new Date().getDay()]} | ${toNepaliNum(todayBs?.day)} ${NP_MONTHS[todayBs?.month]}`);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PUSH NOTIFICATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function requestNotifPermission() {
  if (!('Notification' in window)) { showToast('âŒ Notifications not supported'); return; }
  Notification.requestPermission().then(perm => {
    updateNotifStatus();
    if (perm === 'granted') {
      showToast('âœ… Notifications enabled!');
      new Notification('Naya Patro ğŸ‡³ğŸ‡µ', { body: 'You will now receive holiday & reminder alerts!' });
      addNotification('âœ… Notifications Enabled', 'You will receive holiday reminders and daily panchang updates.');
    } else {
      showToast('âš ï¸ Please allow notifications in browser settings');
    }
  });
}

function updateNotifStatus() {
  const el = document.getElementById('notifStatus');
  if (!el) return;
  const perm = typeof Notification !== 'undefined' ? Notification.permission : 'default';
  el.textContent = perm === 'granted' ? 'âœ… Enabled' : perm === 'denied' ? 'âŒ Blocked â€“ allow in browser settings' : 'Tap to enable';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveSetting(key, val) { localStorage.setItem('setting_'+key, val); }
function loadSettings() {
  const settings = ['morningAlert','holidayAlert'];
  settings.forEach(s => {
    const el = document.getElementById(s+'Toggle') || document.getElementById('morningToggle') || document.getElementById('holidayToggle');
  });
}

function toggleTheme() { showToast('ğŸŒ™ Dark mode is default â€“ looking great!'); }

function exportReminders() {
  if (!reminders.length) { showToast('No reminders to export'); return; }
  const text = reminders.map(r => `${r.title} | ${r.date} ${r.time || ''} | ${r.type} | ${r.note || ''}`).join('\n');
  const blob = new Blob([text], {type:'text/plain'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'naya-patro-reminders.txt';
  a.click();
  showToast('ğŸ“¤ Reminders exported!');
}

function clearAllData() {
  if (!confirm('Delete all reminders and settings?')) return;
  reminders = [];
  notifications = [];
  localStorage.clear();
  renderReminderList();
  renderNotifications();
  updateStats();
  showToast('ğŸ—‘ï¸ All data cleared');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PWA INSTALL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredInstall = e;
  document.getElementById('installBanner').style.display = 'flex';
});

function installPWA() {
  if (deferredInstall) {
    deferredInstall.prompt();
    deferredInstall.userChoice.then(r => {
      if (r.outcome === 'accepted') { showToast('âœ… Naya Patro installed!'); document.getElementById('installBanner').style.display='none'; }
    });
  } else {
    showToast('ğŸ“± Tap browser menu â†’ "Add to Home Screen"');
  }
}

function shareApp() {
  const data = { title:'Naya Patro', text:'à¤¨à¤¯à¤¾ à¤ªà¤¾à¤¤à¥à¤°à¥‹ â€“ Beautiful Nepali Calendar ğŸ‡³ğŸ‡µ', url: window.location.href };
  if (navigator.share) navigator.share(data);
  else { navigator.clipboard?.writeText(window.location.href); showToast('ğŸ”— Link copied!'); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id)?.classList.add('active');
  window.scrollTo(0,0);
}

function setNav(id) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById(id)?.classList.add('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateStats() {
  document.getElementById('statHolidays').textContent = getAllHolidays().length;
  const today = new Date(); today.setHours(0,0,0,0);
  document.getElementById('statReminders').textContent = reminders.filter(r => new Date(r.date) >= today).length;
}

let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2500);
}

// Swipe to close notif panel
let touchStartX = 0;
document.addEventListener('touchstart', e => touchStartX = e.touches[0].clientX);
document.addEventListener('touchend', e => {
  if (e.changedTouches[0].clientX - touchStartX > 60) closeNotifPanel();
});

// Initialize
window.addEventListener('load', init);
</script>
</body>
</html>
